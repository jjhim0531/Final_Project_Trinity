<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reservationMapper">

    <!-- ReservationWithVaccineResult 설정 -->
    <resultMap id="ReservationWithVaccineResult" type="com.project.trinity.reservation.model.vo.Reservation">
        <id property="resNo" column="RES_NO"/>
        <result property="userNo" column="USER_NO"/>
        <result property="hosNo" column="HOS_NO"/>
         <result property="patientName" column="PATIENT_NAME"/> <!-- PATIENT_NAME 추가 -->
       	<result property="patientBirthday" column="PATIENT_BIRTHDAY"/>
        <result property="resDate" column="RES_DATE"/>
        <result property="resTime" column="RES_TIME"/>
        <result property="resCategory" column="RES_CATEGORY"/>
        <result property="resContent" column="RES_CONTENT"/>
    </resultMap>
    
    <!-- 일반 진료 예약 -->
    <insert id="insertgReservation" parameterType="com.project.trinity.reservation.model.vo.Reservation">
    	INSERT INTO GENERAL_RESERVATION
    	(	USER_NO, 
	    	HOS_NO, 
	    	G_PATIENT_NAME, 
	    	G_PATIENT_BIRTHDAY,
	    	G_RES_DATE, 
	    	G_RES_TIME, 
	    	G_RES_SUBJECT, 
	    	G_RES_CONTENT, 
	    	G_RES_GENDER
    	)
		VALUES
    	(
    	#{userNo},
        #{hosNo},
        (SELECT USER_NAME FROM MEMBER WHERE USER_NO = #{userNo}),
        (SELECT BIRTHDAY FROM MEMBER WHERE USER_NO = #{userNo}),
        TO_DATE(#{resDate}, 'YYYY-MM-DD'),
        #{resTime},
        #{subject},
        #{content},
        (SELECT GENDER FROM MEMBER WHERE USER_NO = #{userNo}))
    </insert>
    
    <!-- 예약번호로 조회 -->
	<select id="selectReservation" resultType="com.project.trinity.reservation.model.vo.GeneralReservation">
		SELECT G_RES_NO as gresNo,
			   USER_NO as userNo,
			   HOS_NO as hosNo,
			   GST_NO as gstNo,
			   G_PATIENT_NAME as gpatientName,
			   G_PATIENT_BIRTHDAY as gpatientBirthday,
			   G_RES_DATE as gresDate,
			   G_RES_TIME as gresTime,
			   G_RES_SUBJECT as gresSubject,
			   G_RES_CONTENT as gresContent,
			   G_RES_GENDER as gender
		  FROM GENERAL_RESERVATION
		 WHERE G_RES_NO = #{resNo}
	</select>
    
</mapper>
