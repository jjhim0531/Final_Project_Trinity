-- 기존 테이블 및 시퀀스 삭제
DROP SEQUENCE SEQ_USER_NO;
DROP TABLE HOSPITAL CASCADE CONSTRAINTS;
DROP TABLE MEDICAL_FIELD CASCADE CONSTRAINTS;
DROP TABLE USER_TABLE CASCADE CONSTRAINTS;
DROP TABLE MEMBER CASCADE CONSTRAINTS;
DROP TABLE BOARD CASCADE CONSTRAINTS;
DROP TABLE FILE_TABLE CASCADE CONSTRAINTS;
DROP TABLE COMMENTS_TABLE CASCADE CONSTRAINTS;
DROP TABLE TREATMENT CASCADE CONSTRAINTS;
DROP TABLE RESERVATION CASCADE CONSTRAINTS;
DROP TABLE DOCTOR_REVIEW CASCADE CONSTRAINTS;
DROP TABLE HOSPITAL_KID CASCADE CONSTRAINTS;

-- Drop sequences
BEGIN
    EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_HNO';
    EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_MNO';
    EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_UNO';
    EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_RNO';
    EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_BNO';
    EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_FNO';
    EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_CNO';
    EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_TNO';
    EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_RESNO';
EXCEPTION
    WHEN OTHERS THEN NULL;
END;
/

-- 시퀀스 생성
CREATE SEQUENCE SEQ_USER_NO START WITH 1 INCREMENT BY 1 NOCACHE;

-- HOSPITAL 테이블 생성
CREATE TABLE HOSPITAL (
    HOS_NO VARCHAR2(2000) NOT NULL PRIMARY KEY,
    HOS_ID VARCHAR2(20) NOT NULL,
    HOS_PWD VARCHAR2(20) NOT NULL,
    HOS_NAME VARCHAR2(50) NOT NULL,
    HOS_ADDRESS VARCHAR2(200) NOT NULL,
    HOS_TEL VARCHAR2(20) NOT NULL,
    HOS_YEAR DATE DEFAULT SYSDATE,
    HOS_TIME VARCHAR2(20) NOT NULL,
    HOS_INFO VARCHAR2(2000),
    HOS_LATITUDE NUMBER,
    HOS_LONGITUDE NUMBER,
    HOS_ONDUTY VARCHAR2(20),
    HOS_PARKING VARCHAR2(100)
);

-- MEDICAL_FIELD 테이블 생성
CREATE TABLE MEDICAL_FIELD (
    MED_NO NUMBER NOT NULL PRIMARY KEY,
    JOB VARCHAR2(50) NOT NULL,
    MEDICAL_FIELD_ID VARCHAR2(20) NOT NULL
);

-- MEMBER 테이블 생성
CREATE TABLE MEMBER (
    USER_NO VARCHAR2(100) PRIMARY KEY,
    USER_ID VARCHAR2(20) NOT NULL UNIQUE,
    USER_PWD VARCHAR2(100) NOT NULL,
    USER_NAME VARCHAR2(20) NOT NULL,
    EMAIL VARCHAR2(50) NOT NULL,
    PHONE VARCHAR2(20) NOT NULL,
    BIRTHDAY DATE NOT NULL,
    GENDER CHAR(1) DEFAULT 'M' CHECK (GENDER IN ('M', 'F')),
    ADDRESS VARCHAR2(200),
    ENROLL_DATE DATE DEFAULT SYSDATE,
    STATUS CHAR(1) DEFAULT 'Y' CHECK (STATUS IN ('Y', 'N')),
    ISADMIN VARCHAR2(10) DEFAULT 'N',
    MED_KEY NUMBER,
    HOS_NO VARCHAR2(2000),
    FOREIGN KEY (MED_KEY) REFERENCES MEDICAL_FIELD (MED_NO),
    FOREIGN KEY (HOS_NO) REFERENCES HOSPITAL (HOS_NO)
);

-- DOCTOR_REVIEW 테이블 생성
CREATE TABLE DOCTOR_REVIEW (
    REVIEW_NO NUMBER NOT NULL PRIMARY KEY,
    USER_NO VARCHAR2(100) NOT NULL,
    REVIEW_TITLE VARCHAR2(200) NOT NULL,
    REVIEW_CONTENT VARCHAR2(2000) NOT NULL,
    REVIEW_CREATED_AT DATE DEFAULT SYSDATE,
    REVIEW_UPDATED_AT DATE DEFAULT SYSDATE,
    REVIEW_VIEWS NUMBER,
    REVIEW_RATING NUMBER,
    USER_ID2 VARCHAR2(20),
    FOREIGN KEY (USER_NO) REFERENCES MEMBER (USER_NO)
);

-- RESERVATION 테이블 생성
CREATE TABLE RESERVATION (
    RES_NO NUMBER NOT NULL PRIMARY KEY,
    USER_NO VARCHAR2(100) NOT NULL,
    HOS_NO VARCHAR2(2000) NOT NULL,
    RES_DATE DATE DEFAULT SYSDATE,
    RES_TIME DATE NOT NULL,
    RES_CATEGORY VARCHAR2(20) NOT NULL,
    RES_CONTENT VARCHAR2(2000),
    FOREIGN KEY (USER_NO) REFERENCES MEMBER (USER_NO),
    FOREIGN KEY (HOS_NO) REFERENCES HOSPITAL (HOS_NO)
);

-- TREATMENT 테이블 생성
CREATE TABLE TREATMENT (
    TREATMENT_NO NUMBER NOT NULL PRIMARY KEY,
    RES_NO NUMBER NOT NULL,
    VACCINE_CATEGORY VARCHAR2(20),
    HEALTH_SELECT VARCHAR2(20),
    RES_SELECT VARCHAR2(20),
    FOREIGN KEY (RES_NO) REFERENCES RESERVATION (RES_NO)
);

-- BOARD 테이블 생성
CREATE TABLE BOARD (
    BOARD_NO NUMBER NOT NULL PRIMARY KEY,
    USER_NO VARCHAR2(100) NOT NULL,
    TITLE VARCHAR2(200) NOT NULL,
    CONTENT VARCHAR2(2000) NOT NULL,
    ENROLL_DATE DATE DEFAULT SYSDATE,
    MODIFIED_DATE DATE DEFAULT SYSDATE,
    VIEWS NUMBER,
    BOARD_CATEGORY VARCHAR2(20),
    FOREIGN KEY (USER_NO) REFERENCES MEMBER (USER_NO)
);

-- FILE_TABLE 테이블 생성
CREATE TABLE FILE_TABLE (
    FILE_NO NUMBER NOT NULL PRIMARY KEY,
    BOARD_NO NUMBER NOT NULL,
    USER_NO VARCHAR2(100) NOT NULL,
    ORIGIN_NAME VARCHAR2(200),
    CHANGE_NAME VARCHAR2(200),
    FOREIGN KEY (BOARD_NO) REFERENCES BOARD (BOARD_NO),
    FOREIGN KEY (USER_NO) REFERENCES MEMBER (USER_NO)
);

-- COMMENTS_TABLE 테이블 생성
CREATE TABLE COMMENTS_TABLE (
    COMMENT_NO NUMBER NOT NULL PRIMARY KEY,
    BOARD_NO NUMBER NOT NULL,
    USER_NO VARCHAR2(100) NOT NULL,
    CONTENT VARCHAR2(2000),
    CREATED_AT DATE DEFAULT SYSDATE,
    FOREIGN KEY (BOARD_NO) REFERENCES BOARD (BOARD_NO),
    FOREIGN KEY (USER_NO) REFERENCES MEMBER (USER_NO)
);

-- HOSPITAL_KID 테이블 생성
CREATE TABLE HOSPITAL_KID (
    name VARCHAR2(100),
    address VARCHAR2(200),
    division VARCHAR2(50),
    department VARCHAR2(50),
    start_time VARCHAR2(10),
    end_time VARCHAR2(10),
    hpid VARCHAR2(20) PRIMARY KEY,
    latitude NUMBER(10, 7),
    longitude NUMBER(10, 7)
);

-- 예시 데이터 삽입
INSERT INTO MEDICAL_FIELD VALUES (1 , '간호사', '소아과');
INSERT INTO MEDICAL_FIELD VALUES (2 , '의사', '내과');
INSERT INTO MEDICAL_FIELD VALUES (3, '의사', '소아과');
INSERT INTO MEDICAL_FIELD VALUES (4, '간호사', '안과');
INSERT INTO MEDICAL_FIELD VALUES (5, '의사', '소아과');


